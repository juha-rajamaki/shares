<!DOCTYPE html>
<html>
<head>
  <title></title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.0/lodash.min.js"></script>
  <script type="text/javascript"
          src="https://www.google.com/jsapi?autoload={
            'modules':[{
              'name':'visualization',
              'version':'1',
              'packages':['corechart']
            }]
          }"></script>
  <script>
    var maxValue = undefined;
    var minValue = undefined;

    google.setOnLoadCallback(function() {
      var chartAll = new google.visualization.LineChart(document.getElementById('chart-all'));
      var chartShort = new google.visualization.LineChart(document.getElementById('chart-short'));

      setInterval(function() {
        $.get('http://localhost:9191', function(data) {
          drawData(data, chartAll, 'Long period', { trendlines: { 0: {
            type: 'exponential',
              visibleInLegend: true,
              color: 'blue'
          }}});
        });
      }, 10000);

      setInterval(function() {
        $.get('http://localhost:9191', function(data) {
          drawData(_.takeRight(data, 300), chartShort, 'Short period - 5 minutes');
        });
      }, 1000);
    });

    function drawData(values, chart, title, extraOptions) {

      var i = 0;

      var arr = [ ['aika', 'arvo'] ];

      _.forEach(values, function(val) {
        i = i + 1;

        var value = parseInt(val);

        if (minValue === undefined) {
          minValue = value;
        }

        if (maxValue === undefined) {
          maxValue = value;
        }

        if (value < minValue) {
          minValue = value;
        } else if (value > maxValue) {
          maxValue = value;
        }

        arr.push([ i / 60, value ]);
      });

      values.pop(); // pop the empty value from the end...

      $('#last-value').text(values.pop());

      var data = google.visualization.arrayToDataTable(arr);

      console.log(maxValue);
      console.log(minValue);

      var options = {
        title: title,
        curveType: 'function',
        legend: { position: 'right' },
        colors: ['#b4ce2f', '#f68920', '#002c5b', '#9f0a34'],
        vAxis: {
          maxValue: maxValue + 10,
          minValue: minValue - 10
        }
      };

      chart.draw(data, _.merge(options, extraOptions));
    }
  </script>
  <style>
    .chart {
      width: 100%;
      height: 400px;
    }
  </style>
</head>
<body>
<div id="chart-all" class="chart"></div>
<div id="chart-short" class="chart"></div>
<div class="meters">
  Last value: <span id="last-value">Unknown</span>
</div>
</body>
</html>